<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Products</title>
  <link rel="stylesheet" href="/manageProducts.css">


</head>

<body>

<div class="profile-container">
  <!-- Home button outside container -->
  <div class="back-btn">
    <a href="/users/dashboard" class="btn btn-primary">üè† Home</a>
  </div>

  <div class="container">
    <a href="/users/admin" class="back">Go to Admin Dashboard</a>
    <h2>
      üì¶ Manage Products
      <a href="/users/admin/products/add" class="add-btn">+ Add New Product</a>
    </h2>
    

    <div class="table-container">
      <table>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Status</th>
          <th>Description</th>
          <th>Actions</th>
        </tr>

        <% products.forEach(p => { %>
          <tr id="product-<%= p._id %>" class="<%= (highlightedProduct && highlightedProduct === p._id.toString()) ? 'highlighted-row' : '' %>">
            <!-- Image -->
            <td>
              <% 
                let img = (p.images && p.images.length > 0)
                  ? p.images[0]
                  : (p.imageUrl || "/placeholder.jpg");
              %>
              <img src="<%= img %>">
            </td>

            <!-- Name -->
            <td><%= p.name %></td>

            <!-- Category -->
            <td><%= p.category || "General" %></td>

            <!-- Price -->
            <td>‚Ç±<%= p.price %></td>

            <!-- Stock -->
            <td><%= typeof p.stock === "number" ? p.stock : 0 %></td>

            <!-- Status -->
            <td>
              <% if (p.status === "available") { %>
                <span class="status-available">Available</span>
              <% } else if (p.status === "unavailable") { %>
                <span class="status-unavailable">Unavailable</span>
              <% } else { %>
                <span class="status-maintenance">Maintenance</span>
              <% } %>
            </td>

            <!-- Description - SCROLLABLE -->
            <td class="description-cell">
              <div class="description-scroll">
                <%= p.description || 'No description' %>
              </div>
            </td>

            <!-- Actions -->
            <td class="actions">
              <a href="/users/admin/products/edit/<%= p._id %>" class="edit-btn">Edit</a>
              <a href="/users/admin/products/delete/<%= p._id %>" class="delete-btn" onclick="return confirm('Delete this product?')">Delete</a>
            </td>
          </tr>
        <% }) %>
      </table>
    </div>
  </div>
</div>

<script>
  // Auto-scroll to highlighted product and handle animation
  document.addEventListener('DOMContentLoaded', function() {
    <% if (typeof highlightedProduct !== 'undefined' && highlightedProduct) { %>
      console.log('Looking for product:', '<%= highlightedProduct %>');
      const highlightedRow = document.getElementById('product-<%= highlightedProduct %>');
      if (highlightedRow) {
        console.log('Found product row, scrolling and highlighting...');
        
        // Scroll to the highlighted row
        highlightedRow.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'center' 
        });

        // Remove highlight class after animation completes (2 seconds)
        setTimeout(() => {
          highlightedRow.classList.remove('highlighted-row');
          console.log('Highlight removed');
          
          // Remove the highlight parameter from URL without reloading
          const url = new URL(window.location);
          url.searchParams.delete('highlight');
          window.history.replaceState({}, '', url);
        }, 2000);
      } else {
        console.log('Product row not found with ID: product-<%= highlightedProduct %>');
      }
    <% } else { %>
      console.log('No product to highlight');
    <% } %>
  });
</script>

</body>
</html>