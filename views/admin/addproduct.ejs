<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Product</title>
  <link rel="stylesheet" href="/addproduct.css">


</head>

<body>

<div class="profile-container">
  <!-- Home button outside container -->
  <div class="back-btn">
    <a href="/users/dashboard" class="btn btn-primary">üè† Home</a>
  </div>

  <div class="container">
    <a href="/users/dashboard" class="back">‚¨Ö Back to Dashboard</a>
    <h2>‚ûï Add New Product</h2>

    <form action="/users/admin/products/add" method="POST" enctype="multipart/form-data" id="productForm">
      <label>Name</label>
      <input type="text" name="name" required>

      <label>Price</label>
      <input type="number" step="0.01" name="price" required>

      <label>Description</label>
      <textarea name="description" rows="4" required></textarea>

      <label>Upload Images</label>
      <div id="dropZone" class="drop-zone">
        <span class="drop-zone-icon">üìÅ</span>
        <p class="drop-zone-text">Click to select images or drag & drop here</p>
        <p class="drop-zone-subtext">You can select multiple files one by one</p>
        <input type="file" name="images" accept="image/*" multiple required id="imageInput" style="display: none;">
      </div>
      
      <!-- Image Preview Container -->
      <div class="image-preview-container" id="imagePreview"></div>

      <label>Category</label>
      <select name="category" required>
        <option value="">Select category</option>
        <option value="Food">Food</option>
        <option value="Cars">Cars</option>
        <option value="Electronics">Electronics</option>
        <option value="Clothes">Clothes</option>
        <option value="Accessories">Accessories</option>
        <option value="Home">Home</option>
        <option value="Sports">Sports</option>
        <option value="Books">Books</option>
        <option value="Toys">Toys</option>
        <option value="Beauty">Beauty</option>
        <option value="Fitness">Fitness</option>
        <option value="Health">Health</option>
        <option value="Office">Office Supplies</option>
        <option value="Pets">Pet Supplies</option>
        <option value="Garden">Garden</option>
        <option value="Music">Music</option>
        <option value="Jewelry">Jewelry</option>
        <option value="Tools">Tools</option>
        <option value="Appliances">Appliances</option>
        <option value="Gadgets">Gadgets</option>
        <option value="Software">Software</option>
        <option value="Games">Games</option>
        <option value="Subscriptions">Subscriptions</option>
        <option value="Courses">Online Courses</option>
        <option value="Services">Services</option>
        <option value="Beverages">Beverages</option>
        <option value="Snacks">Snacks</option>
        <option value="Fruits">Fruits</option>
        <option value="Vegetables">Vegetables</option>
        <option value="Frozen">Frozen Food</option>
        <option value="Bakery">Bakery</option>
      </select>

      <label>Status</label>
      <select name="status" required>
        <option value="available">Available</option>
        <option value="unavailable">Unavailable</option>
        <option value="maintenance">Under Maintenance</option>
      </select>
      
      <label>Stock</label>
      <input type="number" name="stock" min="0" value="10" required>

      <button type="submit">Add Product</button>
    </form>
  </div>
</div>

<script>
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('imageInput');
  const previewContainer = document.getElementById('imagePreview');
  const fileCountText = document.createElement('div');
  
  // Add file count display
  fileCountText.style.cssText = 'color: var(--accent-green); font-weight: 600; margin-top: 10px;';
  dropZone.appendChild(fileCountText);

  let uploadedFiles = [];

  // Click on drop zone to trigger file input
  dropZone.addEventListener('click', () => {
    fileInput.click();
  });

  // Handle file selection
  fileInput.addEventListener('change', function(e) {
    handleFiles(this.files);
  });

  // Drag and drop functionality
  dropZone.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.classList.add('dragover');
  });

  dropZone.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
  });

  dropZone.addEventListener('drop', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
    
    if (e.dataTransfer.files.length) {
      handleFiles(e.dataTransfer.files);
    }
  });

  function handleFiles(files) {
    console.log('Files selected:', files.length);
    
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      
      // Check if file is an image
      if (!file.type.startsWith('image/')) {
        alert('Please select only image files.');
        continue;
      }
      
      // Check if file is already uploaded
      if (uploadedFiles.some(f => f.name === file.name && f.size === file.size && f.lastModified === file.lastModified)) {
        console.log('File already uploaded:', file.name);
        continue;
      }
      
      uploadedFiles.push(file);
      
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const previewDiv = document.createElement('div');
        previewDiv.className = 'image-preview';
        previewDiv.setAttribute('data-filename', file.name);
        
        const img = document.createElement('img');
        img.src = e.target.result;
        img.alt = 'Preview image ' + (i + 1);
        
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'remove-image';
        removeBtn.innerHTML = '√ó';
        removeBtn.title = 'Remove image';
        removeBtn.onclick = function() {
          // Remove from preview
          previewDiv.remove();
          
          // Remove from uploaded files array
          const index = uploadedFiles.findIndex(f => f.name === file.name);
          if (index > -1) {
            uploadedFiles.splice(index, 1);
          }
          
          // Update file input and display
          updateFileInput();
          updateFileCount();
        };
        
        previewDiv.appendChild(img);
        previewDiv.appendChild(removeBtn);
        previewContainer.appendChild(previewDiv);
      };
      
      reader.readAsDataURL(file);
    }
    
    updateFileInput();
    updateFileCount();
  }

  function updateFileInput() {
    // Update the actual file input with all uploaded files
    const dt = new DataTransfer();
    uploadedFiles.forEach(file => dt.items.add(file));
    fileInput.files = dt.files;
  }

  function updateFileCount() {
    const totalFiles = uploadedFiles.length;
    fileCountText.textContent = totalFiles > 0 ? `${totalFiles} image(s) selected` : '';
  }

  // Form validation
  document.getElementById('productForm').addEventListener('submit', function(e) {
    const files = fileInput.files;
    
    if (files.length === 0) {
      e.preventDefault();
      alert('Please select at least one image.');
      return false;
    }
    
    const price = document.querySelector('input[name="price"]').value;
    if (parseFloat(price) <= 0) {
      e.preventDefault();
      alert('Please enter a valid price greater than 0.');
      return false;
    }
    
    const stock = document.querySelector('input[name="stock"]').value;
    if (parseInt(stock) < 0) {
      e.preventDefault();
      alert('Stock cannot be negative.');
      return false;
    }
    
    return true;
  });
</script>

</body>
</html>