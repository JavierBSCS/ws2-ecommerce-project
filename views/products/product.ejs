<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= product.name %></title>
  <link rel="stylesheet" href="/product.css">


</head>

<body>

<div class="profile-container">
  <!-- Home button outside container -->
  <div class="back-btn">
    <a href="/users/dashboard" class="btn btn-primary">üè† Home</a>
  </div>

  <div class="container">
    <a href="/users/dashboard" class="back">‚¨Ö Back to Products</a>
    <h1><%= product.name %></h1>

    <div class="price">‚Ç±<%= (product.price || 0).toFixed(2) %></div>

    <!-- Product Gallery -->
    <div class="product-gallery">
      <!-- Thumbnails -->
      <div class="thumbnail-container">
        <% 
          let images = product.images && product.images.length ? product.images : 
                      (product.imageUrl ? [product.imageUrl] : ['/placeholder.png']);
        %>
        <% images.forEach((img, index) => { %>
          <img src="<%= img %>" 
               alt="Thumbnail <%= index + 1 %>" 
               class="thumbnail <%= index === 0 ? 'active' : '' %>"
               data-index="<%= index %>"
               onclick="changeMainImage(<%= index %>)">
        <% }) %>
      </div>

      <!-- Main Image -->
      <div class="main-image-container">
        <img src="<%= images[0] %>" 
             alt="<%= product.name %>" 
             class="main-image"
             onclick="openModal(0)"
             id="mainImage">
      </div>
    </div>

    <!-- Product Details -->
    <div class="product-details">
      <div class="detail-item">
        <strong>Category:</strong>
        <span class="value"><%= product.category || 'General' %></span>
      </div>

      <div class="detail-item">
        <strong>Description:</strong>
        <div class="description-scroll">
          <p><%= product.description || 'No description available' %></p>
        </div>
      </div>

      <div class="detail-item">
        <strong>Stock:</strong>
        <span class="value"><%= typeof product.stock === 'number' ? product.stock : '‚Äî' %></span>
        <% if (product.status) { %>
          <span class="status-badge 
            <% if (product.status === 'available') { %> status-available 
            <% } else if (product.status === 'unavailable') { %> status-unavailable 
            <% } else if (product.status === 'maintenance') { %> status-maintenance 
            <% } %>">
            <%= product.status %>
          </span>
        <% } %>
      </div>

      <% if (product.createdAt) { %>
        <div class="detail-item">
          <strong>Added:</strong>
          <span class="value"><%= new Date(product.createdAt).toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric'
          }) %></span>
        </div>
      <% } %>
    </div>

    <!-- Actions -->
    <div class="actions">
      <% if (user && user.role === "admin") { %>
        <span class="btn btn-disabled">Admins cannot buy</span>
        <a href="/users/admin/products/edit/<%= product._id %>" class="btn btn-primary">‚úè Edit Product</a>
      <% } else { %>
        <% if (product.stock > 0 && product.status === 'available') { %>
          <a href="/cart/add/<%= product._id %>" class="btn btn-success">üõí Add to Cart</a>
        <% } else { %>
          <span class="btn btn-disabled">Out of Stock</span>
        <% } %>
      <% } %>
    </div>
  </div>
</div>

<!-- Fullscreen Modal -->
<div id="imageModal" class="modal">
  <button class="close-modal" onclick="closeModal()">&times;</button>
  <div class="modal-content">
    <button class="nav-arrow prev" onclick="navigateModal(-1)">‚ùÆ</button>
    <img class="modal-image" id="modalImage" src="" alt="">
    <button class="nav-arrow next" onclick="navigateModal(1)">‚ùØ</button>
    <div class="image-counter" id="imageCounter"></div>
  </div>
</div>

<script>
  // Product images array
  const productImages = [
    <% 
      let allImages = product.images && product.images.length ? product.images : 
                     (product.imageUrl ? [product.imageUrl] : ['/placeholder.png']);
    %>
    <% allImages.forEach((img, index) => { %>
      "<%= img %>"<%= index < allImages.length - 1 ? ',' : '' %>
    <% }) %>
  ];

  let currentImageIndex = 0;

  // Change main image when thumbnail is clicked
  function changeMainImage(index) {
    currentImageIndex = index;
    const mainImage = document.getElementById('mainImage');
    mainImage.src = productImages[index];
    
    // Update active thumbnail
    document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
      thumb.classList.toggle('active', i === index);
    });
  }

  // Modal functions
  function openModal(index) {
    currentImageIndex = index;
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const imageCounter = document.getElementById('imageCounter');
    
    modalImage.src = productImages[index];
    imageCounter.textContent = `${index + 1} / ${productImages.length}`;
    modal.style.display = 'block';
    
    // Update active thumbnail
    document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
      thumb.classList.toggle('active', i === index);
    });
  }

  function closeModal() {
    document.getElementById('imageModal').style.display = 'none';
  }

  function navigateModal(direction) {
    currentImageIndex += direction;
    
    // Loop around
    if (currentImageIndex < 0) {
      currentImageIndex = productImages.length - 1;
    } else if (currentImageIndex >= productImages.length) {
      currentImageIndex = 0;
    }
    
    openModal(currentImageIndex);
  }

  // Keyboard navigation
  document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('imageModal');
    if (modal.style.display === 'block') {
      if (e.key === 'ArrowLeft') {
        navigateModal(-1);
      } else if (e.key === 'ArrowRight') {
        navigateModal(1);
      } else if (e.key === 'Escape') {
        closeModal();
      }
    }
  });

  // Close modal when clicking outside image
  document.getElementById('imageModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });
</script>

</body>
</html>